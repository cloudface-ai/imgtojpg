class BlogManager{constructor(){this.currentPost=null,this.quill=null,this.posts=this.loadPosts(),this.categories=this.loadCategories(),this.media=this.loadMedia(),this.settings=this.loadSettings(),this.init()}init(){console.log("Blog Manager initializing..."),window.addEventListener("error",e=>{console.error("Global error caught:",e.error),this.showNotification("JavaScript error: "+(e.error?.message||"Unknown error"),"error")}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason),this.showNotification("Promise error: "+(e.reason?.message||"Unknown error"),"error")}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initializeComponents()):this.initializeComponents()}initializeComponents(){try{this.checkAuth()?(console.log("Authentication successful, initializing components..."),this.loadData(),this.initQuill(),this.bindEvents(),this.showSection("dashboard"),this.updateDashboard(),this.loadPostsList(),this.loadCategoriesList(),this.loadMediaGrid(),console.log("Blog Manager initialized successfully")):(console.log("Authentication failed - redirecting to login"),window.location.href="/blog-login.html")}catch(e){console.error("Error during initialization:",e),this.showNotification("Error during initialization. Please refresh the page.","error")}}loadData(){try{console.log("Loading data from localStorage..."),this.posts=this.loadPosts(),console.log(`Loaded ${this.posts.length} posts`),this.categories=this.loadCategories(),console.log(`Loaded ${this.categories.length} categories`),this.media=this.loadMedia(),console.log(`Loaded ${this.media.length} media items`),this.settings=this.loadSettings(),console.log("Settings loaded"),this.currentPost||(console.log("No current post, creating new one"),this.newPost())}catch(e){console.error("Error loading data:",e),this.showNotification("Error loading data. Please refresh the page.","error")}}checkAuth(){var e="true"===localStorage.getItem("blogAuth"),t=localStorage.getItem("blogUser");return e&&t?(console.log("User authenticated:",t),!0):(console.log("Authentication failed - redirecting to login"),!1)}logout(){localStorage.removeItem("blogAuth"),localStorage.removeItem("blogUser"),window.location.href="/blog-login.html"}initQuill(){let t=()=>{if(console.log("Attempting to initialize Quill editor..."),console.log("Quill available:","undefined"!=typeof Quill),"undefined"!=typeof Quill)try{var e;document.getElementById("editor")?(this.quill=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["link","image","video"],["clean"]]},placeholder:"Start writing your blog post..."}),console.log("Quill editor initialized successfully"),(e=document.getElementById("editorLoading"))&&(e.style.display="none")):(console.error("Editor element not found"),this.fallbackToTextarea())}catch(e){console.error("Error initializing Quill:",e),this.fallbackToTextarea()}else console.log("Quill not available, waiting..."),setTimeout(()=>{"undefined"==typeof Quill?(console.log("Quill.js failed to load after timeout, using fallback editor"),this.fallbackToTextarea()):(console.log("Quill became available, retrying initialization"),t())},2e3)};t()}fallbackToTextarea(){console.log("Initializing fallback textarea editor");var e,t=document.getElementById("editor");t&&((e=document.getElementById("editorLoading"))&&(e.style.display="none"),t.innerHTML=`
                <div class="mb-4">
                    <div class="flex space-x-2 mb-2 p-2 bg-gray-100 rounded-lg">
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="bold"><strong>B</strong></button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="italic"><em>I</em></button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="underline"><u>U</u></button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="h1">H1</button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="h2">H2</button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="h3">H3</button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="ul">• List</button>
                        <button type="button" class="format-btn px-3 py-1 bg-white border rounded hover:bg-gray-50" data-format="ol">1. List</button>
                    </div>
                    <textarea id="fallbackEditor" class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Start writing your blog post..."></textarea>
                </div>
            `,document.querySelectorAll(".format-btn").forEach(e=>{e.addEventListener("click",e=>{var e=e.target.dataset.format,t=document.getElementById("fallbackEditor"),o=t.selectionStart,s=t.selectionEnd,a=t.value;let i="";switch(e){case"bold":i=`**${a.substring(o,s)}**`;break;case"italic":i=`*${a.substring(o,s)}*`;break;case"underline":i=`<u>${a.substring(o,s)}</u>`;break;case"h1":i="# "+a.substring(o,s);break;case"h2":i="## "+a.substring(o,s);break;case"h3":i="### "+a.substring(o,s);break;case"ul":i="• "+a.substring(o,s);break;case"ol":i="1. "+a.substring(o,s)}t.value=a.substring(0,o)+i+a.substring(s),t.focus()})}),this.showNotification("Using fallback editor (Quill.js failed to load)","info"))}bindEvents(){document.querySelectorAll(".nav-item").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.dataset.section;this.showSection(e),this.updateActiveNav(t)})}),document.getElementById("sidebarToggle").addEventListener("click",()=>{document.getElementById("sidebar").classList.toggle("-translate-x-full")}),document.getElementById("newPostBtn").addEventListener("click",()=>{this.showSection("create"),this.newPost()}),document.getElementById("logoutBtn").addEventListener("click",()=>{this.logout()}),document.getElementById("saveDraftBtn").addEventListener("click",()=>this.saveDraft()),document.getElementById("previewBtn").addEventListener("click",()=>this.previewPost()),document.getElementById("publishBtn").addEventListener("click",()=>this.publishPost()),document.getElementById("addCategoryBtn").addEventListener("click",()=>this.showCategoryModal()),document.getElementById("saveCategoryBtn").addEventListener("click",()=>this.saveCategory()),document.getElementById("cancelCategoryBtn").addEventListener("click",()=>this.hideCategoryModal()),document.getElementById("uploadMediaBtn").addEventListener("click",()=>this.showMediaModal()),document.getElementById("refreshMediaBtn").addEventListener("click",()=>this.refreshMediaLibrary()),document.getElementById("clearStorageBtn").addEventListener("click",()=>this.clearStorage()),document.getElementById("selectMediaBtn").addEventListener("click",()=>document.getElementById("mediaUpload").click()),document.getElementById("cancelMediaBtn").addEventListener("click",()=>this.hideMediaModal()),document.getElementById("mediaUpload").addEventListener("change",e=>this.handleMediaUpload(e)),document.getElementById("featuredImage").addEventListener("change",e=>this.handleFeaturedImage(e));var e=document.getElementById("featuredImageContainer");let t=document.getElementById("featuredImage");var o=document.getElementById("removeFeaturedImage");e&&t&&e.addEventListener("click",()=>{this.ensureCurrentPost()&&t.click()}),o&&o.addEventListener("click",e=>{e.stopPropagation(),this.removeFeaturedImage()}),document.getElementById("autoTitleBtn").addEventListener("click",()=>this.autoGenerateTitle()),document.getElementById("autoDescBtn").addEventListener("click",()=>this.autoGenerateDescription()),document.getElementById("autoKeywordsBtn").addEventListener("click",()=>this.autoGenerateKeywords()),document.getElementById("autoTagsBtn").addEventListener("click",()=>this.autoGenerateTags()),this.initDragAndDrop(),document.getElementById("searchPosts").addEventListener("input",e=>this.filterPosts(e.target.value)),document.getElementById("statusFilter").addEventListener("change",e=>this.filterPostsByStatus(e.target.value)),document.querySelectorAll("#settings input, #settings textarea").forEach(e=>{e.addEventListener("change",()=>this.saveSettings())}),document.getElementById("quickCreatePost").addEventListener("click",()=>{this.showSection("create"),this.newPost()}),document.getElementById("quickUploadMedia").addEventListener("click",()=>{this.showSection("media"),this.showMediaModal()}),document.getElementById("quickManageSettings").addEventListener("click",()=>{this.showSection("settings")}),document.getElementById("quickViewBlog").addEventListener("click",()=>{window.open("/blog.html","_blank")})}showSection(t){document.querySelectorAll(".section").forEach(e=>{e.classList.add("hidden")}),document.getElementById(t).classList.remove("hidden"),document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("text-blue-600","bg-blue-50"),e.dataset.section===t&&e.classList.add("text-blue-600","bg-blue-50")})}updateActiveNav(e){document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("text-blue-600","bg-blue-50")}),e.classList.add("text-blue-600","bg-blue-50")}newPost(){try{this.currentPost={id:Date.now(),title:"",content:"",status:"draft",publishDate:(new Date).toISOString().slice(0,16),categories:"",tags:"",featuredImage:"",metaTitle:"",metaDescription:"",metaKeywords:"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),views:0},console.log("New post created with ID:",this.currentPost.id),this.loadPostIntoForm(),this.clearForm();var e=document.getElementById("createTitle");e&&(e.textContent="Create New Post")}catch(e){console.error("Error creating new post:",e),this.showNotification("Error creating new post. Please try again.","error")}}clearForm(){var e;document.getElementById("postTitle").value="",document.getElementById("postStatus").value="draft",document.getElementById("publishDate").value=(new Date).toISOString().slice(0,16),document.getElementById("postCategories").value="",document.getElementById("postTags").value="",document.getElementById("metaTitle").value="",document.getElementById("metaDescription").value="",document.getElementById("metaKeywords").value="",this.quill?this.quill.root.innerHTML="":(e=document.getElementById("fallbackEditor"))&&(e.value=""),this.removeFeaturedImage(),console.log("Form cleared successfully")}editPost(t){try{var e;this.currentPost=this.posts.find(e=>e.id===t),this.currentPost?(console.log("Editing post:",this.currentPost.title),this.loadPostIntoForm(),(e=document.getElementById("createTitle"))&&(e.textContent="Edit Post"),this.showSection("create")):(console.error("Post not found for editing:",t),this.showNotification("Post not found for editing","error"))}catch(e){console.error("Error editing post:",e),this.showNotification("Error editing post. Please try again.","error")}}duplicatePost(t){var e=this.posts.find(e=>e.id===t);e&&(this.currentPost={...e,id:Date.now(),title:e.title+" (Copy)",status:"draft",publishDate:(new Date).toISOString().slice(0,16),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),views:0},this.loadPostIntoForm(),document.getElementById("createTitle").textContent="Duplicate Post",this.showSection("create"))}deletePost(t){var e;confirm("Are you sure you want to delete this post? This action cannot be undone.")&&-1!==(e=this.posts.findIndex(e=>e.id===t))&&(this.posts.splice(e,1),this.savePosts(),this.updateDashboard(),this.loadPostsList(),this.showNotification("Post deleted successfully","success"))}previewPostById(t){var e=this.posts.find(e=>e.id===t);e&&(this.currentPost=e,this.previewPost())}loadPostIntoForm(){var e;this.currentPost&&(document.getElementById("postTitle").value=this.currentPost.title,document.getElementById("postStatus").value=this.currentPost.status,document.getElementById("publishDate").value=this.currentPost.publishDate,document.getElementById("postCategories").value=this.currentPost.categories,document.getElementById("postTags").value=this.currentPost.tags,document.getElementById("metaTitle").value=this.currentPost.metaTitle,document.getElementById("metaDescription").value=this.currentPost.metaDescription,document.getElementById("metaKeywords").value=this.currentPost.metaKeywords,this.currentPost.featuredImage?this.displayFeaturedImage(this.currentPost.featuredImage):this.removeFeaturedImage(),this.quill?this.quill.root.innerHTML=this.currentPost.content||"":(e=document.getElementById("fallbackEditor"))&&(e.value=this.currentPost.content||""))}saveDraft(){try{console.log("Saving draft..."),this.validatePostForm()&&this.savePost("draft")}catch(e){console.error("Error saving draft:",e),this.showNotification("Error saving draft. Please try again.","error")}}publishPost(){try{console.log("Publishing post..."),this.validatePostForm()&&this.savePost("published")}catch(e){console.error("Error publishing post:",e),this.showNotification("Error publishing post. Please try again.","error")}}savePost(e){try{var t,o,s,a,i,r,n,l,d,c,u;console.log("Saving post with status: "+e),this.currentPost?(t=document.getElementById("postTitle"),o=document.getElementById("publishDate"),s=document.getElementById("postCategories"),a=document.getElementById("postTags"),i=document.getElementById("metaTitle"),r=document.getElementById("metaDescription"),n=document.getElementById("metaKeywords"),t?(l=t.value.trim())?(this.currentPost.title=l,this.quill&&this.quill.root?(this.currentPost.content=this.quill.root.innerHTML,console.log("Content saved from Quill editor")):(d=document.getElementById("fallbackEditor"))?(this.currentPost.content=d.value,console.log("Content saved from fallback editor")):(this.currentPost.content="",console.warn("No editor found, content set to empty")),this.currentPost.status=e,this.currentPost.publishDate=o?o.value:(new Date).toISOString().slice(0,16),this.currentPost.categories=s?s.value:"",this.currentPost.tags=a?a.value:"",this.currentPost.metaTitle=i?i.value:"",this.currentPost.metaDescription=r?r.value:"",this.currentPost.metaKeywords=n?n.value:"",this.currentPost.updatedAt=(new Date).toISOString(),"published"!==e||this.currentPost.publishDate||(this.currentPost.publishDate=(new Date).toISOString()),console.log("Post data updated:",{id:this.currentPost.id,title:this.currentPost.title,status:this.currentPost.status,contentLength:this.currentPost.content.length}),this.posts||(this.posts=[],console.log("Posts array initialized")),this.currentPost.id?-1!==(c=this.posts.findIndex(e=>e.id===this.currentPost.id))?(this.posts[c]={...this.currentPost},console.log("Post updated at index "+c)):(this.posts.push({...this.currentPost}),console.log("Post added to posts array")):(this.posts.push({...this.currentPost}),console.log("New post added to posts array")),this.savePosts(),console.log("Posts saved to localStorage"),this.updateDashboard(),this.loadPostsList(),u="published"===e?`Post "${l}" published successfully!`:`Draft "${l}" saved successfully!`,this.showNotification(u,"success"),console.log("Post saved successfully with status: "+e),console.log("Saved post details:",{id:this.currentPost.id,title:this.currentPost.title,status:this.currentPost.status,publishDate:this.currentPost.publishDate,contentLength:this.currentPost.content.length,categories:this.currentPost.categories,tags:this.currentPost.tags})):(this.showNotification("Please enter a post title","error"),t.focus()):(console.error("Post title element not found"),this.showNotification("Form elements not found. Please refresh the page.","error"))):(console.error("No current post available for saving"),this.showNotification("No post to save. Please create a new post first.","error"))}catch(e){console.error("Error in savePost:",e),this.showNotification("Error saving post: "+e.message,"error")}}previewPost(){var e,t=document.getElementById("postTitle").value;let o="";this.quill?o=this.quill.root.innerHTML:(e=document.getElementById("fallbackEditor"))&&(o=e.value),t.trim()?((e=window.open("","_blank")).document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Preview: ${t}</title>
                <script src="https://cdn.tailwindcss.com"></script>
            </head>
            <body class="bg-gray-50">
                <div class="max-w-4xl mx-auto p-8">
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h1 class="text-4xl font-bold text-gray-900 mb-6">${t}</h1>
                        <div class="prose max-w-none">
                            ${o}
                        </div>
                    </div>
                </div>
            </body>
            </html>
        `),e.document.close()):this.showNotification("Please enter a post title","error")}deletePost(t){confirm("Are you sure you want to delete this post?")&&(this.posts=this.posts.filter(e=>e.id!==t),this.savePosts(),this.updateDashboard(),this.loadPostsList(),this.showNotification("Post deleted successfully","success"))}duplicatePost(t){var e=this.posts.find(e=>e.id===t);e&&(e={...e,id:Date.now(),title:e.title+" (Copy)",status:"draft",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),views:0},this.posts.push(e),this.savePosts(),this.updateDashboard(),this.loadPostsList(),this.showNotification("Post duplicated successfully","success"))}loadPostsList(){var e=document.getElementById("postsList");e&&(e.innerHTML=this.posts.map(e=>`
            <div class="post-card bg-white p-6 rounded-lg shadow-sm border" data-post-id="${e.id}">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <h3 class="text-lg font-semibold text-gray-900">${e.title||"Untitled Post"}</h3>
                            <span class="status-${e.status} px-2 py-1 rounded-full text-xs font-medium">
                                ${e.status.charAt(0).toUpperCase()+e.status.slice(1)}
                            </span>
                        </div>
                        <p class="text-gray-600 text-sm mb-3">
                            ${e.content?e.content.replace(/<[^>]*>/g,"").substring(0,150)+"...":"No content"}
                        </p>
                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                            <span><i class="fas fa-calendar mr-1"></i>${new Date(e.createdAt).toLocaleDateString()}</span>
                            <span><i class="fas fa-eye mr-1"></i>${e.views} views</span>
                            <span><i class="fas fa-folder mr-1"></i>${e.categories||"Uncategorized"}</span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-post-btn text-blue-600 hover:text-blue-800 p-2" data-post-id="${e.id}" title="Edit Post">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="preview-post-btn text-purple-600 hover:text-purple-800 p-2" data-post-id="${e.id}" title="Preview Post">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="duplicate-post-btn text-green-600 hover:text-green-800 p-2" data-post-id="${e.id}" title="Duplicate Post">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="delete-post-btn text-red-600 hover:text-red-800 p-2" data-post-id="${e.id}" title="Delete Post">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `).join(""),this.bindPostActionEvents())}filterPosts(t){var e=this.posts.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.content.toLowerCase().includes(t.toLowerCase())||e.categories.toLowerCase().includes(t.toLowerCase())||e.tags.toLowerCase().includes(t.toLowerCase()));this.displayFilteredPosts(e)}filterPostsByStatus(t){var e;t?(e=this.posts.filter(e=>e.status===t),this.displayFilteredPosts(e)):this.loadPostsList()}displayFilteredPosts(e){var t=document.getElementById("postsList");t&&(t.innerHTML=e.map(e=>`
            <div class="post-card bg-white p-6 rounded-lg shadow-sm border" data-post-id="${e.id}">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <h3 class="text-lg font-semibold text-gray-900">${e.title||"Untitled Post"}</h3>
                            <span class="status-${e.status} px-2 py-1 rounded-full text-xs font-medium">
                                ${e.status.charAt(0).toUpperCase()+e.status.slice(1)}
                            </span>
                        </div>
                        <p class="text-gray-600 text-sm mb-3">
                            ${e.content?e.content.replace(/<[^>]*>/g,"").substring(0,150)+"...":"No content"}
                        </p>
                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                            <span><i class="fas fa-calendar mr-1"></i>${new Date(e.createdAt).toLocaleDateString()}</span>
                            <span><i class="fas fa-eye mr-1"></i>${e.views} views</span>
                            <span><i class="fas fa-folder mr-1"></i>${e.categories||"Uncategorized"}</span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-post-btn text-blue-600 hover:text-blue-800 p-2" data-post-id="${e.id}" title="Edit Post">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="preview-post-btn text-purple-600 hover:text-purple-800 p-2" data-post-id="${e.id}" title="Preview Post">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="duplicate-post-btn text-green-600 hover:text-green-800 p-2" data-post-id="${e.id}" title="Duplicate Post">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="delete-post-btn text-red-600 hover:text-red-800 p-2" data-post-id="${e.id}" title="Delete Post">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `).join(""),this.bindPostActionEvents())}bindPostActionEvents(){document.querySelectorAll(".edit-post-btn").forEach(e=>{e.addEventListener("click",e=>{e=parseInt(e.target.closest("button").dataset.postId);this.editPost(e)})}),document.querySelectorAll(".preview-post-btn").forEach(e=>{e.addEventListener("click",e=>{e=parseInt(e.target.closest("button").dataset.postId);this.previewPostById(e)})}),document.querySelectorAll(".duplicate-post-btn").forEach(e=>{e.addEventListener("click",e=>{e=parseInt(e.target.closest("button").dataset.postId);this.duplicatePost(e)})}),document.querySelectorAll(".delete-post-btn").forEach(e=>{e.addEventListener("click",e=>{e=parseInt(e.target.closest("button").dataset.postId);this.deletePost(e)})})}updateDashboard(){var e=this.posts.length,t=this.posts.filter(e=>"published"===e.status).length,o=this.posts.filter(e=>"draft"===e.status).length,s=this.posts.reduce((e,t)=>e+t.views,0),e=(document.getElementById("totalPosts").textContent=e,document.getElementById("publishedPosts").textContent=t,document.getElementById("draftPosts").textContent=o,document.getElementById("totalViews").textContent=s,document.getElementById("recentPosts"));e&&(t=this.posts.sort((e,t)=>new Date(t.updatedAt)-new Date(e.updatedAt)).slice(0,5),e.innerHTML=t.map(e=>`
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <div>
                        <p class="font-medium text-gray-900">${e.title||"Untitled Post"}</p>
                        <p class="text-sm text-gray-500">${new Date(e.updatedAt).toLocaleDateString()}</p>
                    </div>
                    <span class="status-${e.status} px-2 py-1 rounded-full text-xs font-medium">
                        ${e.status.charAt(0).toUpperCase()+e.status.slice(1)}
                    </span>
                </div>
            `).join(""))}showCategoryModal(){document.getElementById("categoryModal").classList.remove("hidden"),document.getElementById("categoryName").value="",document.getElementById("categoryDescription").value=""}hideCategoryModal(){document.getElementById("categoryModal").classList.add("hidden")}saveCategory(){var e=document.getElementById("categoryName").value.trim(),t=document.getElementById("categoryDescription").value.trim();e?(e={id:Date.now(),name:e,description:t,postCount:0,createdAt:(new Date).toISOString()},this.categories.push(e),this.saveCategories(),this.loadCategoriesList(),this.hideCategoryModal(),this.showNotification("Category created successfully","success")):this.showNotification("Category name is required","error")}deleteCategory(t){confirm("Are you sure you want to delete this category?")&&(this.categories=this.categories.filter(e=>e.id!==t),this.saveCategories(),this.loadCategoriesList(),this.showNotification("Category deleted successfully","success"))}loadCategoriesList(){var e=document.getElementById("categoriesList");e&&(e.innerHTML=this.categories.map(e=>`
            <div class="bg-white p-6 rounded-lg shadow-sm border">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">${e.name}</h3>
                        <p class="text-gray-600 text-sm mb-3">${e.description||"No description"}</p>
                        <p class="text-sm text-gray-500">${e.postCount} posts</p>
                    </div>
                    <button onclick="blogManager.deleteCategory(${e.id})" class="text-red-600 hover:text-red-800 p-2">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join(""))}showMediaModal(){var e=document.getElementById("mediaModal");e?(this.resetUploadForm(),e.classList.remove("hidden"),console.log("Media modal opened with clean state")):console.error("Media modal element not found")}hideMediaModal(){var e=document.getElementById("mediaModal");e?(e.classList.add("hidden"),setTimeout(()=>{this.resetUploadForm()},300)):console.error("Media modal element not found")}initDragAndDrop(){let t=document.getElementById("dragDropArea"),o=document.getElementById("uploadIcon"),s=document.getElementById("dragText");t&&o&&s?(["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation()})}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,()=>{t.classList.add("border-blue-500","bg-blue-100"),o.classList.remove("text-gray-400"),o.classList.add("text-blue-500"),s.textContent="Drop files here!"})}),t.addEventListener("dragleave",()=>{t.classList.remove("border-blue-500","bg-blue-100"),o.classList.remove("text-blue-500"),o.classList.add("text-gray-400"),s.textContent="Drag and drop files here or"}),t.addEventListener("drop",e=>{t.classList.remove("border-blue-500","bg-blue-100"),o.classList.remove("text-blue-500"),o.classList.add("text-gray-400"),s.textContent="Drag and drop files here or";e=Array.from(e.dataTransfer.files);this.processMediaFiles(e)})):console.warn("Drag and drop elements not found")}handleMediaUpload(e){e=Array.from(e.target.files);this.processMediaFiles(e)}processMediaFiles(e){try{var t,o;console.log("Processing files:",e.length),e&&0!==e.length?0===(t=e.filter(e=>e.type.startsWith("image/"))).length?this.showNotification("No valid image files selected. Please select JPG, PNG, GIF, WebP, or SVG files.","error"):10<t.length?this.showNotification("Maximum 10 files can be uploaded at once. Please select fewer files.","error"):0<(o=t.filter(e=>2097152<e.size)).length?this.showNotification("Some files are too large (max 2MB): "+o.map(e=>e.name).join(", "),"error"):(console.log(`Starting upload of ${t.length} valid image files`),this.checkUploadElements()?(this.showUploadProgress(t.length),this.uploadMultipleFiles(t)):this.showNotification("Upload system not ready. Please refresh the page.","error")):this.showNotification("No files selected","error")}catch(e){console.error("Error processing media files:",e),this.showNotification("Error processing files. Please try again.","error")}}checkUploadElements(){var e;for(e of["uploadProgress","uploadCount","progressBar","uploadActions"])if(!document.getElementById(e))return console.error("Required upload element not found: "+e),!1;return!0}ensureCurrentPost(){return!!this.currentPost||(console.log("No current post, creating new one"),this.newPost(),!1)}validatePostForm(){var e=document.getElementById("postTitle")?.value?.trim(),t=this.getEditorContent()?.trim();return e?!(!t||t.length<10)||(this.showNotification("Please add some content to your post (at least 10 characters)","error"),!1):(this.showNotification("Please enter a post title","error"),!1)}showUploadProgress(e){var t=document.getElementById("uploadProgress"),o=document.getElementById("uploadCount"),s=document.getElementById("progressBar");t&&o&&s?(t.classList.remove("hidden"),o.textContent="0/"+e,s.style.width="0%",(o=t.querySelector("span:first-child"))&&(o.textContent=`Uploading ${e} file${1<e?"s":""}...`),console.log(`Upload progress started for ${e} files`)):console.error("Upload progress elements not found")}hideUploadProgress(){var e=document.getElementById("uploadProgress"),t=document.getElementById("mediaUpload");e&&e.classList.add("hidden"),t&&(t.value="")}showUploadComplete(e){console.log(`Showing upload complete for ${e} files`);var t=document.getElementById("uploadActions"),t=(t&&t.classList.add("hidden"),document.getElementById("uploadProgress"));t?(t.innerHTML=`
            <div class="space-y-4">
                <div class="text-center">
                    <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
                    <p class="text-green-600 font-semibold text-lg">${e} files uploaded successfully!</p>
                    <p class="text-sm text-gray-500 mt-2">Your media is now available in the library</p>
                </div>
                <div class="flex space-x-3">
                    <button id="uploadDoneBtn" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-check mr-2"></i>Done
                    </button>
                    <button id="uploadMoreBtn" class="flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Upload More
                    </button>
                    <button id="viewMediaBtn" class="flex-1 border border-blue-300 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-50 transition-colors">
                        <i class="fas fa-images mr-2"></i>View Media
                    </button>
                </div>
            </div>
        `,t.classList.remove("hidden"),this.bindUploadCompleteEvents(),console.log("Upload complete UI displayed")):console.error("Upload progress element not found")}bindUploadCompleteEvents(){console.log("Binding upload complete events");var e=document.getElementById("uploadDoneBtn"),e=(e?e.addEventListener("click",()=>{console.log("Done button clicked, closing modal"),this.hideMediaModal()}):console.warn("Done button not found"),document.getElementById("uploadMoreBtn")),e=(e?e.addEventListener("click",()=>{console.log("Upload More button clicked, resetting form"),this.resetUploadForm()}):console.warn("Upload More button not found"),document.getElementById("viewMediaBtn"));e?e.addEventListener("click",()=>{console.log("View Media button clicked, going to media library"),this.hideMediaModal(),this.showSection("media")}):console.warn("View Media button not found")}resetUploadForm(){var e=document.getElementById("uploadProgress"),t=document.getElementById("dragDropArea"),o=document.getElementById("uploadIcon"),s=document.getElementById("dragText"),a=document.getElementById("mediaUpload"),i=document.getElementById("uploadActions");e&&t&&o&&s&&a&&i?(e.classList.add("hidden"),t.classList.remove("border-blue-500","bg-blue-100"),o.classList.remove("text-blue-500"),o.classList.add("text-gray-400"),s.textContent="Drag and drop files here or",a.value="",i.classList.remove("hidden"),e.innerHTML=`
            <div class="space-y-3">
                <div class="flex items-center justify-between text-sm">
                    <span>Uploading...</span>
                    <span id="uploadCount">0/0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        `,console.log("Upload form reset successfully")):console.error("Some upload form elements not found")}uploadMultipleFiles(e){let a=0,i=e.length,r=Date.now();console.log(`Starting upload of ${i} files`);e.forEach((t,e)=>{let o=Date.now(),s=setTimeout(()=>{console.error("Upload timeout for file: "+t.name),this.showNotification("Upload timeout for "+t.name,"error"),a++,this.updateUploadProgress(a,i),a===i&&this.handleUploadCompletion(i,r)},3e4);this.uploadMediaFile(t,()=>{clearTimeout(s);var e=Date.now()-o;a++,console.log(`File ${a}/${i} completed: ${t.name} (${e}ms)`),this.updateUploadProgress(a,i),a===i&&this.handleUploadCompletion(i,r)})})}handleUploadCompletion(e,t){let o=Date.now()-t;console.log(`All ${e} files uploaded in ${o}ms, showing completion`),console.log("Current media count:",this.media.length),console.log("Media items:",this.media),setTimeout(()=>{this.showNotification(`${e} files uploaded successfully in ${Math.round(o/1e3)}s!`,"success"),this.showUploadComplete(e)},500)}cleanupOldMedia(){if(console.log("Cleaning up old media to free storage space..."),this.media.length<=5)console.log("Not enough media to clean up");else{var e=[...this.media].sort((e,t)=>new Date(e.createdAt)-new Date(t.createdAt)),t=Math.max(1,Math.floor(.2*this.media.length)),e=e.slice(0,t);console.log(`Removing ${t} old media files to free space`),e.forEach(t=>{var e=this.media.findIndex(e=>e.id===t.id);-1!==e&&(this.media.splice(e,1),console.log("Removed old media: "+t.name))});try{this.saveMedia(),console.log("Cleaned media list saved successfully")}catch(e){console.error("Error saving cleaned media list:",e)}}}uploadMediaFile(o,s){if(console.log(`Starting upload for file: ${o.name} (${o.size} bytes, ${o.type})`),2097152<o.size)this.showNotification(`File ${o.name} is too large (${Math.round(o.size/1024/1024*100)/100}MB). Max size is 2MB.`,"error"),s&&s();else{var e=new FileReader;e.onload=e=>{try{console.log("File loaded successfully: "+o.name);var t={id:Date.now()+Math.random(),name:o.name,type:o.type,size:o.size,url:e.target.result,createdAt:(new Date).toISOString()};console.log("Created media item:",t),this.media.push(t),console.log("Added to media array, current length:",this.media.length);try{this.saveMedia(),console.log("Media saved to localStorage")}catch(e){if("QuotaExceededError"!==e.name)throw e;console.warn("localStorage quota exceeded, trying to clean up old media"),this.cleanupOldMedia();try{this.saveMedia(),console.log("Media saved after cleanup")}catch(e){return console.error("Still cannot save after cleanup:",e),this.showNotification("Storage full. Please delete some old media files.","error"),this.media.pop(),void(s&&s())}}this.loadMediaGrid(),console.log("Media grid updated"),console.log("Successfully uploaded: "+o.name),s&&(console.log("Calling callback for:",o.name),s())}catch(e){console.error("Error processing uploaded file:",e),this.showNotification(`Error processing ${o.name}: `+e.message,"error"),s&&s()}},e.onerror=e=>{console.error("FileReader error for:",o.name,e),this.showNotification("Error reading "+o.name,"error"),s&&s()},e.onabort=()=>{console.error("FileReader aborted for:",o.name),this.showNotification("Upload aborted for "+o.name,"error"),s&&s()};try{e.readAsDataURL(o),console.log("Started reading file: "+o.name)}catch(e){console.error("Error starting file read:",e),this.showNotification("Error starting upload for "+o.name,"error"),s&&s()}}}updateUploadProgress(e,t){var o=document.getElementById("progressBar"),s=document.getElementById("uploadCount");o&&s?(o.style.width=e/t*100+"%",s.textContent=e+"/"+t):console.error("Progress elements not found")}selectMediaItem(t){let e=this.media.find(e=>e.id===t);e&&navigator.clipboard.writeText(e.url).then(()=>{this.showNotification("Media URL copied to clipboard!","success")}).catch(()=>{this.showNotification("Media selected: "+e.name,"info")})}copyMediaUrl(t){var e=this.media.find(e=>e.id===t);e&&navigator.clipboard.writeText(e.url).then(()=>{this.showNotification("Media URL copied to clipboard!","success")}).catch(()=>{this.showNotification("Failed to copy URL","error")})}deleteMediaItem(t){var o=this.media.find(e=>e.id===t);if(o){let e="";if(this.checkMediaUsage(t)&&(e="\n\n⚠️ WARNING: This media is currently being used in one or more blog posts. Deleting it may break those posts."),confirm(`Are you sure you want to delete "${o.name}"?

This action cannot be undone and the file will be permanently removed from your media library.`+e))try{var s,a=this.media.findIndex(e=>e.id===t);-1!==a?(s=this.media[a].name,this.media.splice(a,1),this.saveMedia(),this.loadMediaGrid(),this.showNotification(`Media "${s}" deleted successfully`,"success"),console.log(`Deleted media: ${s} (ID: ${t})`)):this.showNotification("Media item not found in array","error")}catch(e){console.error("Error deleting media:",e),this.showNotification("Error deleting media file","error")}}else this.showNotification("Media item not found","error")}checkMediaUsage(t){return this.posts.some(e=>!(!e.featuredImage||!e.featuredImage.includes(t))||!(!e.content||!e.content.includes(t)))}refreshMediaLibrary(){this.loadMediaGrid(),this.showNotification("Media library refreshed","success")}clearStorage(){if(confirm("Are you sure you want to clear all media storage? This will permanently delete all uploaded media files and cannot be undone."))try{localStorage.removeItem("blogMedia"),this.media=[],this.loadMediaGrid(),this.showNotification("Storage cleared successfully. All media files have been removed.","success"),console.log("Storage cleared successfully")}catch(e){console.error("Error clearing storage:",e),this.showNotification("Error clearing storage","error")}}handleFeaturedImage(e){try{var t,o;this.currentPost?(t=e.target.files[0])?t.type.startsWith("image/")?5242880<t.size?this.showNotification("Featured image is too large. Please use an image under 5MB.","error"):(console.log(`Processing featured image: ${t.name} (${t.size} bytes)`),(o=new FileReader).onload=e=>{try{this.addWatermarkToImage(e.target.result,e=>{this.currentPost?(this.currentPost.featuredImage=e,this.displayFeaturedImage(e),this.showNotification("Featured image set successfully with watermark","success"),console.log("Featured image set successfully")):(console.error("Current post no longer available"),this.showNotification("Error setting featured image. Please try again.","error"))})}catch(e){console.error("Error processing featured image:",e),this.showNotification("Error processing featured image. Please try again.","error")}},o.onerror=e=>{console.error("Error reading featured image file:",e),this.showNotification("Error reading image file. Please try again.","error")},o.readAsDataURL(t)):this.showNotification("Please select a valid image file (JPG, PNG, GIF, WebP, SVG)","error"):console.warn("No file selected for featured image"):(console.error("No current post available for featured image"),this.showNotification("Please create or select a post first","error"))}catch(e){console.error("Error handling featured image:",e),this.showNotification("Error setting featured image. Please try again.","error")}}addWatermarkToImage(e,d){try{if(e){let l=new Image;l.onload=()=>{try{var e,t,o,s,a,i,r=document.createElement("canvas"),n=r.getContext("2d");n?(r.width=l.width,r.height=l.height,n.drawImage(l,0,0),e=Math.max(16,Math.floor(.03*l.width)),t=(n.font=`bold ${e}px Arial`,n.fillStyle="rgba(255, 255, 255, 0.8)",n.strokeStyle="rgba(0, 0, 0, 0.8)",n.lineWidth=2,"imgtojpg.org"),o=n.measureText(t),s=l.width-o.width-20,a=l.height-20,i=(n.strokeText(t,s,a),n.fillText(t,s,a),r.toDataURL("image/jpeg",.9)),console.log("Watermark added successfully"),d(i)):(console.error("Could not get canvas context"),d(null))}catch(e){console.error("Error adding watermark:",e),d(null)}},l.onerror=e=>{console.error("Error loading image for watermarking:",e),d(null)},l.src=e}else console.error("No image data provided for watermarking"),d(null)}catch(e){console.error("Error in watermarking process:",e),d(null)}}displayFeaturedImage(e){try{var t,o,s;e?(t=document.getElementById("featuredImagePreview"),o=document.getElementById("featuredImagePlaceholder"),s=document.getElementById("featuredImageDisplay"),t&&o&&s?(s.src=e,t.classList.remove("hidden"),o.classList.add("hidden"),console.log("Featured image displayed successfully")):console.error("Featured image display elements not found")):console.error("No image data provided for display")}catch(e){console.error("Error displaying featured image:",e)}}removeFeaturedImage(){try{this.currentPost&&(this.currentPost.featuredImage="",console.log("Featured image cleared from current post"));var e=document.getElementById("featuredImagePreview"),t=document.getElementById("featuredImagePlaceholder");e&&t?(e.classList.add("hidden"),t.classList.remove("hidden"),this.showNotification("Featured image removed","success"),console.log("Featured image removed successfully")):console.error("Featured image display elements not found for removal")}catch(e){console.error("Error removing featured image:",e),this.showNotification("Error removing featured image","error")}}autoGenerateTitle(){var t=document.getElementById("postTitle").value;this.getEditorContent();if(t){let e=t;e.toLowerCase().includes("imgtojpg")||(e+=" - imgtojpg.org"),60<e.length&&(e=e.substring(0,57)+"..."),document.getElementById("metaTitle").value=e,this.showNotification("SEO title generated successfully","success")}else this.showNotification("Please enter a post title first","error")}autoGenerateDescription(){var t=this.getEditorContent();if(t&&50<t.length){let e=t.replace(/<[^>]*>/g,"").trim();e=(e=150<e.length?e.substring(0,147)+"...":e).replace(/\s+/g," ").trim(),document.getElementById("metaDescription").value=e,this.showNotification("SEO description generated successfully","success")}else this.showNotification("Please add some content to your post first","error")}autoGenerateKeywords(){var e=document.getElementById("postTitle").value,o=this.getEditorContent();if(e||o){var s=[];if(e&&(e=e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(e=>3<e.length),s.push(...e)),o){e=o.replace(/<[^>]*>/g," ").toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(e=>3<e.length);let t={};e.forEach(e=>{t[e]=(t[e]||0)+1});o=Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,5).map(([e])=>e);s.push(...o)}s.push(...["image conversion","jpg","png","webp","heic","tiff","svg"]);e=[...new Set(s)].slice(0,10);document.getElementById("metaKeywords").value=e.join(", "),this.showNotification("SEO keywords generated successfully","success")}else this.showNotification("Please add some content to your post first","error")}autoGenerateTags(){var e=document.getElementById("postTitle").value,t=this.getEditorContent();e||t?(t=[],e&&(e=e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(e=>2<e.length),t.push(...e)),(e=document.getElementById("postCategories").value)&&(e=e.split(",").map(e=>e.trim()),t.push(...e)),t.push(...["conversion","image","format","tool","online"]),e=[...new Set(t)].slice(0,8),document.getElementById("postTags").value=e.join(", "),this.showNotification("Tags generated successfully","success")):this.showNotification("Please add some content to your post first","error")}getEditorContent(){var e;return this.quill?this.quill.root.innerHTML:(e=document.getElementById("editor"))?e.value:""}loadMediaGrid(){var e=document.getElementById("mediaGrid");e&&(0===this.media.length?e.innerHTML=`
                <div class="col-span-full text-center py-12">
                    <i class="fas fa-images text-4xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 text-lg">No media files yet</p>
                    <p class="text-gray-400 text-sm">Upload some images to get started</p>
                </div>
            `:e.innerHTML=this.media.map(e=>`
                <div class="media-item bg-white p-4 rounded-lg shadow-sm border cursor-pointer hover:shadow-md" data-media-id="${e.id}">
                    <div class="aspect-square mb-3 overflow-hidden rounded-lg bg-gray-100">
                        <img src="${e.url}" alt="${e.name}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                    </div>
                    <div class="text-center">
                        <p class="text-sm font-medium text-gray-900 truncate mb-1" title="${e.name}">${e.name}</p>
                        <p class="text-xs text-gray-500 mb-2">${this.formatFileSize(e.size)}</p>
                        <div class="flex justify-center space-x-2">
                            <button class="copy-media-btn text-blue-600 hover:text-blue-800 p-1" title="Copy URL" data-media-id="${e.id}">
                                <i class="fas fa-copy text-xs"></i>
                            </button>
                            <button class="delete-media-btn text-red-600 hover:text-red-800 p-1" title="Delete" data-media-id="${e.id}">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join(""),this.updateStorageInfo(),this.bindMediaItemEvents())}updateStorageInfo(){var t=document.getElementById("storageUsed"),o=document.getElementById("mediaCount");if(t&&o)try{var e=JSON.stringify(this.media),s=new Blob([e]).size,a=Math.round(s/1024);t.textContent=a,o.textContent=this.media.length,t.className=4e3<a?"text-red-600 font-bold":2e3<a?"text-yellow-600 font-bold":"text-blue-600",console.log(`Storage info updated: ${a}KB, ${this.media.length} files`)}catch(e){console.error("Error updating storage info:",e),t.textContent="Error",o.textContent="Error"}}bindMediaItemEvents(){console.log("Binding media item events..."),document.querySelectorAll(".media-item").forEach(t=>{t.addEventListener("click",e=>{e.target.closest("button")||(e=t.dataset.mediaId,console.log("Media item clicked:",e),this.selectMediaItem(e))})});var e=document.querySelectorAll(".copy-media-btn"),e=(console.log("Found copy buttons:",e.length),e.forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();e=t.dataset.mediaId;console.log("Copy button clicked for media:",e),this.copyMediaUrl(e)})}),document.querySelectorAll(".delete-media-btn"));console.log("Found delete buttons:",e.length),e.forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();e=t.dataset.mediaId;console.log("Delete button clicked for media:",e),this.deleteMediaItem(e)})})}formatFileSize(e){var t;return 0===e?"0 Bytes":(t=Math.floor(Math.log(e)/Math.log(1024)),parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t])}saveSettings(){this.settings.blogTitle=document.getElementById("blogTitle").value,this.settings.blogDescription=document.getElementById("blogDescription").value,this.settings.postsPerPage=document.getElementById("postsPerPage").value,this.settings.defaultMetaTitle=document.getElementById("defaultMetaTitle").value,this.settings.defaultMetaDescription=document.getElementById("defaultMetaDescription").value,this.settings.defaultKeywords=document.getElementById("defaultKeywords").value,localStorage.setItem("blogSettings",JSON.stringify(this.settings)),this.showNotification("Settings saved successfully","success")}showNotification(e,t="info"){let o=document.createElement("div");o.className=`notification bg-${"success"===t?"green":"error"===t?"red":"blue"}-500 text-white px-6 py-3 rounded-lg shadow-lg`,o.innerHTML=`
            <div class="flex items-center">
                <i class="fas fa-${"success"===t?"check-circle":"error"===t?"exclamation-circle":"info-circle"} mr-2"></i>
                <span>${e}</span>
            </div>
        `,document.getElementById("notificationContainer").appendChild(o),setTimeout(()=>{o.remove()},3e3)}loadPosts(){var e=localStorage.getItem("blogPosts");return e?JSON.parse(e):[]}savePosts(){try{this.posts||(console.warn("Posts array is undefined, initializing empty array"),this.posts=[]);var e=JSON.stringify(this.posts);console.log(`Saving ${this.posts.length} posts to localStorage`),localStorage.setItem("blogPosts",e),console.log("Posts saved successfully to localStorage")}catch(e){throw console.error("Error saving posts:",e),"QuotaExceededError"===e.name?this.showNotification("Storage full. Please delete some old posts.","error"):this.showNotification("Error saving posts. Please try again.","error"),e}}loadCategories(){var e=localStorage.getItem("blogCategories");return e?JSON.parse(e):[{id:1,name:"General",description:"General blog posts",postCount:0,createdAt:(new Date).toISOString()},{id:2,name:"Image Conversion",description:"Posts about image conversion",postCount:0,createdAt:(new Date).toISOString()},{id:3,name:"Tutorials",description:"How-to guides and tutorials",postCount:0,createdAt:(new Date).toISOString()}]}saveCategories(){localStorage.setItem("blogCategories",JSON.stringify(this.categories))}loadMedia(){var e=localStorage.getItem("blogMedia");return e?JSON.parse(e):[]}saveMedia(){try{var e=JSON.stringify(this.media),t=new Blob([e]).size;console.log(`Saving media data: ${this.media.length} items, ${Math.round(t/1024)}KB`),localStorage.setItem("blogMedia",e),console.log("Media saved successfully")}catch(e){if(console.error("Error saving media:",e),"QuotaExceededError"!==e.name)throw e;console.warn("localStorage quota exceeded, attempting cleanup..."),this.cleanupOldMedia();try{var o=JSON.stringify(this.media);localStorage.setItem("blogMedia",o),console.log("Media saved after cleanup")}catch(e){throw console.error("Still cannot save after cleanup:",e),new Error("Storage full. Please delete some old media files manually.")}}}loadSettings(){var e=localStorage.getItem("blogSettings");return e?JSON.parse(e):{blogTitle:"imgtojpg.org Blog",blogDescription:"Professional image conversion service blog",postsPerPage:10,defaultMetaTitle:"",defaultMetaDescription:"",defaultKeywords:""}}}document.addEventListener("DOMContentLoaded",()=>{window.blogManager=new BlogManager}),"undefined"!=typeof module&&module.exports&&(module.exports=BlogManager);
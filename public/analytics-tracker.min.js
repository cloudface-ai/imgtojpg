(()=>{let s={TRACKING_ID:"imgtojpg_"+Math.random().toString(36).substr(2,9),SESSION_TIMEOUT:18e5,SCROLL_THRESHOLDS:[25,50,75,100],HEARTBEAT_INTERVAL:3e4,MAX_EVENTS_PER_SESSION:100,STORAGE_KEY:"imgtojpg_analytics_data"},n={sessionId:null,startTime:null,lastActivity:null,pageViews:0,events:[],scrollDepth:0,timeOnPage:0,referrer:null,userAgent:navigator.userAgent,screenResolution:screen.width+"x"+screen.height,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone};class e{constructor(){this.initSession()}initSession(){var e=Date.now(),t=this.getLastSession();!t||e-t.lastActivity>s.SESSION_TIMEOUT?this.startNewSession():this.resumeSession(t),this.startHeartbeat()}startNewSession(){n.sessionId=this.generateSessionId(),n.startTime=Date.now(),n.lastActivity=Date.now(),n.pageViews=1,n.events=[],n.scrollDepth=0,n.timeOnPage=0,n.referrer=document.referrer,this.saveSession(),this.trackEvent("session_started")}resumeSession(e){(n={...e}).pageViews++,n.lastActivity=Date.now(),n.referrer=document.referrer,this.saveSession(),this.trackEvent("session_resumed")}generateSessionId(){return"sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getLastSession(){try{var e=localStorage.getItem(s.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.warn("Analytics: Could not load session data"),null}}saveSession(){try{n.lastActivity=Date.now(),localStorage.setItem(s.STORAGE_KEY,JSON.stringify(n))}catch(e){console.warn("Analytics: Could not save session data")}}startHeartbeat(){setInterval(()=>{this.updateActivity()},s.HEARTBEAT_INTERVAL)}updateActivity(){n.lastActivity=Date.now(),n.timeOnPage+=s.HEARTBEAT_INTERVAL/1e3,this.saveSession()}}class t{constructor(){this.setupEventListeners()}trackEvent(e,t={}){e={name:e,data:t,timestamp:Date.now(),page:window.location.pathname,url:window.location.href};n.events.push(e),n.events.length>s.MAX_EVENTS_PER_SESSION&&(n.events=n.events.slice(-s.MAX_EVENTS_PER_SESSION)),o.saveSession(),window.console&&console.log&&console.log("Analytics Event:",e)}setupEventListeners(){document.addEventListener("visibilitychange",()=>{document.hidden?this.trackEvent("page_hidden"):this.trackEvent("page_visible")});let a=0;window.addEventListener("scroll",()=>{let t=Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100);t>a&&(a=t,n.scrollDepth=Math.max(n.scrollDepth,t),s.SCROLL_THRESHOLDS.forEach(e=>{t>=e&&a<e+25&&this.trackEvent("scroll_depth",{depth:e})}))}),document.addEventListener("click",e=>{e=e.target;"BUTTON"!==e.tagName&&"A"!==e.tagName||this.trackEvent("element_clicked",{element:e.tagName.toLowerCase(),text:e.textContent?.trim().substring(0,50),className:e.className,id:e.id}),"INPUT"!==e.tagName&&"SELECT"!==e.tagName&&"TEXTAREA"!==e.tagName||this.trackEvent("form_interaction",{element:e.tagName.toLowerCase(),type:e.type||"text",name:e.name,id:e.id})}),document.addEventListener("submit",e=>{this.trackEvent("form_submitted",{formId:e.target.id,formAction:e.target.action,formMethod:e.target.method})}),document.addEventListener("change",e=>{"file"===e.target.type&&this.trackEvent("file_selected",{inputId:e.target.id,inputName:e.target.name,fileCount:e.target.files?.length||0})}),window.addEventListener("load",()=>{var e,t;window.performance&&window.performance.timing&&(t=(e=window.performance.timing).loadEventEnd-e.navigationStart,this.trackEvent("page_loaded",{loadTime:t,domContentLoaded:e.domContentLoadedEventEnd-e.navigationStart,firstPaint:window.performance.getEntriesByType("paint")[0]?.startTime||0}))}),window.addEventListener("beforeunload",()=>{this.trackEvent("page_unload",{timeOnPage:n.timeOnPage,scrollDepth:n.scrollDepth})})}}class a{constructor(){this.trackPageView()}trackPageView(){var e={title:document.title,url:window.location.href,path:window.location.pathname,search:window.location.search,hash:window.location.hash,referrer:document.referrer,timestamp:Date.now()};this.trackEvent("page_view",e)}trackEvent(e,t){window.analytics&&window.analytics.trackEvent&&window.analytics.trackEvent(e,t)}}class r{constructor(){this.monitorPerformance()}monitorPerformance(){if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{e=e.getEntries(),e=e[e.length-1];this.trackEvent("lcp",{value:e.startTime})}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.trackEvent("fid",{value:e.processingStart-e.startTime})})}).observe({entryTypes:["first-input"]});let a=0;new PerformanceObserver(e=>{for(var t of e.getEntries())t.hadRecentInput||(a+=t.value);this.trackEvent("cls",{value:a})}).observe({entryTypes:["layout-shift"]})}catch(e){console.warn("Analytics: Performance monitoring not available")}if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"img"!==e.initiatorType&&"script"!==e.initiatorType&&"css"!==e.initiatorType||this.trackEvent("resource_loaded",{name:e.name,type:e.initiatorType,duration:e.duration,size:e.transferSize||0})})}).observe({entryTypes:["resource"]})}catch(e){console.warn("Analytics: Resource monitoring not available")}}trackEvent(e,t){window.analytics&&window.analytics.trackEvent&&window.analytics.trackEvent(e,t)}}class i{static exportData(){try{var e,t,a,n=localStorage.getItem(s.STORAGE_KEY);n&&(e=new Blob([n],{type:"application/json"}),t=URL.createObjectURL(e),(a=document.createElement("a")).href=t,a.download=`analytics_${(new Date).toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(t))}catch(e){console.warn("Analytics: Could not export data")}}static clearData(){try{localStorage.removeItem(s.STORAGE_KEY),console.log("Analytics: Data cleared")}catch(e){console.warn("Analytics: Could not clear data")}}static getStats(){try{var e,t=localStorage.getItem(s.STORAGE_KEY);return t?{sessionId:(e=JSON.parse(t)).sessionId,startTime:new Date(e.startTime),lastActivity:new Date(e.lastActivity),pageViews:e.pageViews,eventsCount:e.events.length,scrollDepth:e.scrollDepth,timeOnPage:e.timeOnPage}:null}catch(e){return console.warn("Analytics: Could not get stats"),null}}}let o,c,l,d;function m(){try{o=new e,c=new t,l=new a,d=new r,window.imgtojpgAnalytics={trackEvent:(e,t)=>c.trackEvent(e,t),exportData:i.exportData,clearData:i.clearData,getStats:i.getStats,getData:()=>n},console.log("imgtojpg.org Analytics initialized successfully")}catch(e){console.error("Analytics initialization failed:",e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),"undefined"!=typeof module&&module.exports&&(module.exports={WebsiteAnalytics:WebsiteAnalytics,SessionManager:e,EventTracker:t,DataManager:i})})();